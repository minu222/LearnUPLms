<!-- templates/board/courseReview.html -->
<div th:fragment="content">
    <main class="main-content">
        <!-- 헤더: 요청하신 클래스 네이밍으로 적용 -->
            <h2 class="board-title">
                강의 후기 <span class="badge-pill">REVIEW</span>
                <small class="sub">구매 하기전에 확인하세요</small>
            </h2>


            <!-- 검색바: th 및 #searchInput / #searchBtn ID 유지 -->
            <div class="filters search search-bar">
                <form class="board-utils search" id="freeBoardSearchForm" method="get">
                <input
                        class="search-input"
                        type="text"
                        name="q"
                        id="searchInput"
                        placeholder="검색어 입력"
                        th:value="${param.q}"
                />
                <button class="search-button" id="searchBtn" type="button">검색</button>
                </form>
            </div>

        <!-- 목록 테이블 (th는 기존 그대로 유지) -->
        <table class="table-notice">
            <thead>
            <tr>
                <th style="width:8%;">NO</th>
                <th style="width:60%;">제목</th>
                <th style="width:16%;">작성일</th>
                <th style="width:16%;">작성자</th>
            </tr>
            </thead>
            <tbody>
            <!-- 빈 목록 -->
            <tr th:if="${#lists.isEmpty(posts)}">
                <td colspan="4" class="empty">게시글이 없습니다.</td>
            </tr>

            <!-- 목록 -->
            <tr th:each="post, stat : ${posts}">
                <td th:text="${stat.count}">1</td>
                <td class="title-cell">
                    <a
                            th:href="@{|/board/${typeSlug}/${post.id}|}"
                            th:text="${post.title}"
                            class="title-link"
                    >리스트</a
                    >
                    <div
                            class="muted"
                            th:if="${post.courseTitle != null or post.score != null}"
                    >
                        <!-- <span th:text="${post.courseTitle}">강의 제목</span> -->
                        <span th:if="${post.score != null}"
                        > · 평점 <span th:text="${post.score}">5</span></span
                        >
                    </div>
                </td>
                <td th:text="${#temporals.format(post.createdAt, 'yyyy-MM-dd')}">
                    2025-09-16
                </td>
                <td th:text="${post.authorName}">홍길동</td>
            </tr>
            </tbody>
        </table>

        <!-- 2) 페이징 컨테이너: 서버 값 주입 -->
        <div id="reviewPagination"
             class="pagination"
             data-total-pages="[[${page.totalPages}]]"
             data-current="[[${page.number + 1}]]"
             data-size="[[${page.size}]]">
        </div>
    </main>
    <!-- 검색 동작: ID, th 그대로 사용 -->
    <script th:inline="javascript">
        (function () {
            const btn = document.getElementById('searchBtn');
            if (!btn) return;
            btn.addEventListener('click', function () {
                const q = document.getElementById('searchInput')?.value || '';
                const f = document.getElementById('filter')?.value || '';
                const params = new URLSearchParams();
                if (q) params.set('q', q);
                if (f) params.set('f', f);
                location.href =
                    '/board/courseReview' + (params.toString() ? ('?' + params.toString()) : '');
            });
        })();
        (function(){
            const el = document.getElementById('reviewPagination');
            if (!el || !window.Pager) return;

            // 서버에서 전달받은 값
            const totalPages = Number(el.dataset.totalPages || 1);
            const current    = Number(el.dataset.current || 1);

            // URL 의 page 파라미터를 바꾸는 onChange
            function goto(p) {
                const u = new URL(location.href);
                u.searchParams.set('page', p);   // 서버 페이징 핸들러와 맞추세요
                // 검색/필터 유지
                const q = document.getElementById('searchInput')?.value;
                if (q) u.searchParams.set('q', q);
                location.href = u.toString();
            }

            // totalPages를 직접 사용 (totalItems 없이도 가능)
            Pager.render({
                totalPages,
                current,
                container: el,
                onChange: goto
            });
        })();
    </script>
</div>
