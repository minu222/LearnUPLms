<!-- templates/board/teacherReview.html -->
<div th:fragment="content">
    <main class="main-content">
        <!-- 헤더 -->
        <h2 class="board-title">
            강사 후기 <span class="badge-pill">REVIEW</span>
            <small class="sub">구매 하기전에 확인하세요</small>
        </h2>

        <!-- 검색바: th 및 #searchInput / #searchBtn ID 유지 -->
        <div class="filters search search-bar">
            <form class="board-utils search" id="freeBoardSearchForm" method="get">
                <input
                        class="search-input"
                        type="text"
                        name="q"
                        id="searchInput"
                        placeholder="검색어 입력"
                        th:value="${param.q}"
                />
                <button class="search-button" id="searchBtn" type="button">검색</button>
            </form>
        </div>

        <!-- 목록 테이블 (courseReview.html 과 동일 패턴) -->
        <table class="table-notice">
            <thead>
            <tr>
                <th style="width:8%;">NO</th>
                <th style="width:60%;">제목</th>
                <th style="width:16%;">작성일</th>
                <th style="width:16%;">작성자</th>
            </tr>
            </thead>
            <tbody>
            <!-- 빈 목록 -->
            <tr th:if="${#lists.isEmpty(posts)}">
                <td colspan="4" class="empty">게시글이 없습니다.</td>
            </tr>

            <!-- 목록 -->
            <tr th:each="post, stat : ${posts}">
                <td th:text="${stat.count}">1</td>
                <td class="title-cell">
                    <a
                            th:href="@{|/board/${typeSlug}/${post.id}|}"
                            th:text="${post.title}"
                            class="title-link"
                    >리스트</a>
                    <div class="muted"
                         th:if="${post['teacherName'] != null or post['score'] != null}">
                        <!-- 필요 시 강사명 노출: <span th:text="${post.teacherName}">강사명</span> -->
                        <span th:if="${post['score'] != null}"> · 평점 <span th:text="${post['score']}">5</span></span>
                            </span>
                    </div>
                </td>
                <td th:text="${#temporals.format(post.createdAt, 'yyyy-MM-dd')}">2025-09-16</td>
                <td th:text="${post.authorName}">홍길동</td>
            </tr>
            </tbody>
        </table>

        <!-- 페이징 컨테이너: 서버 값 주입 -->
        <div id="teacherReviewPagination"
             class="pagination"
             data-total-pages="[[${page.totalPages}]]"
             data-current="[[${page.number + 1}]]"
             data-size="[[${page.size}]]">
        </div>
    </main>

    <!-- pager.js 전역 로드 (레이아웃에 넣어도 됨) -->
    <script src="/js/pager.js"></script>

    <!-- 검색 + 페이징 동작 -->
    <script th:inline="javascript">
        (function () {
            const btn = document.getElementById('searchBtn');
            if (!btn) return;
            btn.addEventListener('click', function () {
                const q = document.getElementById('searchInput')?.value || '';
                const f = document.getElementById('filter')?.value || '';
                const params = new URLSearchParams();
                if (q) params.set('q', q);
                if (f) params.set('f', f);
                location.href =
                    '/board/teacherReview' + (params.toString() ? ('?' + params.toString()) : '');
            });
        })();

        (function(){
            const el = document.getElementById('teacherReviewPagination');
            if (!el || !window.Pager) return;

            // 서버에서 전달받은 값
            const totalPages = Number(el.dataset.totalPages || 1);
            const current    = Number(el.dataset.current || 1);

            // URL 의 page 파라미터를 바꾸는 onChange
            function goto(p) {
                const u = new URL(location.href);
                u.searchParams.set('page', p);   // 서버 페이징 핸들러와 맞추세요
                // 검색/필터 유지
                const q = document.getElementById('searchInput')?.value;
                if (q) u.searchParams.set('q', q);
                location.href = u.toString();
            }

            // totalPages를 직접 사용 (totalItems 없이도 가능)
            Pager.render({
                totalPages,
                current,
                container: el,
                onChange: goto
            });
        })();
    </script>
</div>
